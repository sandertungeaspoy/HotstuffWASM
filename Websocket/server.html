<html>
	<head>
		<meta charset="utf-8"/>
		<script src="wasm_exec.js"></script>
		<script>
            var read = new WebAssembly.Memory({initial:10, maximum:100});
            var write = new WebAssembly.Memory({initial:10, maximum:100});
            var readMsg = new String(read.buffer)
			const go = new Go();
			WebAssembly.instantiateStreaming(fetch("mem.wasm"), go.importObject, { js: { mem: read , mem: write} }).then(
				result => {
          			mod = result.module;
          			inst = result.instance;
          			
        		}
      		);

      		async function run() {
        		await go.run(inst);
        		inst = await WebAssembly.instantiate(mod, go.importObject); // reset instance
                document.getElementById("runButton").disabled = true;
      		}
            
            
            
		</script>
        <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
        <script src="server1.js"></script>
        <script src="server2.js"></script>
        <script src="server3.js"></script>
        <script>
            function startSRV(){
                startWebRTC();
                startWebRTC2();
                startWebRTC3();
                document.getElementById("idButton").disabled = true;
            }
        </script>
        
	</head>
	<body>

		<h1>HotStuff WASM Server</h1>
			Self-ID:<input type="number" id="self-id" step="1" min="1" max="4" name="Server ID" value="1">
			
			<button onClick="GetSelfID('self-id'); startSRV();" id="idButton">Assign</button>
			Chat:<input type="text" id="text" name="charbox" value="Test">
            <p id="textbox">This is a test</p>
			<button onClick="passUint8ArrayToGo();" id="SendButton">Send</button>
            <button onClick="setUint8ArrayInGo();" id="RecvButton">Receive</button>
			<button onClick="run();" id="runButton">Run</button>
            <button onClick="readMessages();" id="readButton" >ReadMsg</button>
	</body>
    
    <!-- <script> 
        var id = document.getElementById("self-id").value;

        function loadScripts() {
            if (id == 1) {
                var script = document.createElement('script');
                script.setAttribute('src', 'server1.js');
                document.head.appendChild(script);
                var script = document.createElement('script');
                script.setAttribute('src', 'server2.js');
                document.head.appendChild(script);
                var script = document.createElement('script');
                script.setAttribute('src', 'server3.js');
                document.head.appendChild(script);
                window.onload = (event) => {
                    console.log("Window loaded")
                    startWebRTC();
                    startWebRTC2();
                    startWebRTC3();
                };

            } else if (id == 2) {
                var script = document.createElement('script');
                script.setAttribute('src', 'server1.js');
                document.head.appendChild(script);
                window.onload = e => function(){
                    console.log("Window loaded")
                    startWebRTC();
                };
            } else if (id == 3) {
                var script = document.createElement('script');
                script.setAttribute('src', 'server2.js');
                document.head.appendChild(script);
                window.onload = e => function(){
                    console.log("Window loaded")
                    startWebRTC2();
                };
            } else if (id == 4) {
                var script = document.createElement('script');
                script.setAttribute('src', 'server3.js');
                document.head.appendChild(script);
                window.onload = e => function(){
                    console.log("Window loaded")
                    startWebRTC3();
                };
            }
        }

    </script> -->

    <script>
        function setText() {
            document.getElementById("textbox").innerHTML = readMsg;
        }
          
        function passUint8ArrayToGo(){

            array_to_pass = new Uint8Array([0, 9, 21, 32])
        
            console.log(array_to_pass)
        
            PassUint8ArrayToGo(array_to_pass)
        }
        
        function setUint8ArrayInGo(){

        arraySize = new Uint8Array(10);
        
        GetArraySize(arraySize);
        
        
        var size = new TextDecoder("utf-8").decode(arraySize);
        var sizeint = parseInt(size);
        console.log(size);


        array_to_set = new Uint8Array(sizeint);
    
        SetUint8ArrayInGo(array_to_set);
    
        sendData(array_to_set);
        sendData2(array_to_set);
        sendData3(array_to_set);
        console.log(array_to_set)
        }

    </script>
</html>